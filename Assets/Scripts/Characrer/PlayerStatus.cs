using Helper;
using proto;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Common;
using Scrimmage;

namespace Character
{
    /// <summary>
    /// 玩家脚本
    /// </summary>
    public class PlayerStatus : CharacterStatus
    {
        private bool isDeathSend = false;
        public override void Death()
        {
            base.Death();
            if (isDeathSend) return;
            //关闭操作面板
            CallLuaHelper.PanelClose("ControlPanel");
            //停止发送同步位置
            GetComponent<CharacterMotor>().enabled = false;
            //发送协议
            MsgDeath msgDeath = new MsgDeath()
            {
                belongCamp = camp,
                deathID = id
            };
            NetWorkFK.NetManager.Send(msgDeath);
            GameManager.Instance.teamDatas.Remove(id);
            if (GameManager.Instance.teamDatas.Count > 0)
            {
                foreach (var item in GameManager.Instance.teamDatas.Values)
                {
                    CameraFollow.Instance.ChangeTarget(item);
                    return;
                }
            }
            isDeathSend = true;
        }
    }
}
